Extrareality API v2
=======

С каждым запросом мы отправляем 2 параметра:

* signature
* datetime

Параметр _signature_ генерируется на основе секретного ключа, который знаем только мы и вы. По нему вы можете убедиться, что запрос действительно идет от нас, но эта проверка не обязательна.

Как формируется подпись (signature), можно глянуть в методе [\Extrareality\Client::generateSignature()](https://github.com/riente/extrareality-api/blob/78f8d4d6e535489e6bea80bc3391dfdd78e7c991/src/Client.php#L162)

Используются параметры:

* datetime - дата и время в формате "Y-m-d H:i:s"
* ownerId - ваш ID квеструма (**не** тот, что в каталоге, нужно уточнить у нас)
* questId - ID квеста, для которого получаются/отправляются данные (по умолчанию такой же, как в URL, например у "Похищения" = 12, http://extrareality.by/quest/12), но можно использовать и внутренний ID на вашем сайте, тогда сообщите нам об этом
* secret - наш общий маленький секрет ;)

### Быстрые ссылки к описанию методов

Вы должны предоставить нам 2 URL на вашем сайте, по которому реализован наш API, и на которые мы будет слать запросы:

* [Бронирование](#бронирование)
* [Расписание](#расписание)

Расписание
---

Метод: GET

Вы выдаете список всех ваших слотов примерно на месяц вперед, но добавляете в каждый из них поле "extraPrices", которое содержит массив. В нём: ключ - условие, значение - цена.

Каждый слот - это объект, содержащий следующие свойства:

* date (Y-m-d)
* time (H:i)
* is_free - (boolean) true означает доступность для бронирования. Если время игры прошло или слот уже забронирован, то необходимо возвращать false.
* extraPrices (массив цен, в котором _ключ_ - это условие, _значение_ - цена).

Также вы можете передавать нам дополнительные параметры, которые мы вернем вам при бронировании (в примере _our_time_id_).

Пример:

```
[
   {
       "date": "2016-05-05",
       "time": "18:30",
       "is_free": true,
       "price": 3000,
       "extraPrices": {
           "2 человека": 80,
           "Больше 2 человек": 110
       },
       "our_time_id": 321
   },
   {
       "date": "2016-05-05",
       "time": "20:00",
       "is_free": false,
       "price": 3500,
       "extraPrices": {
           "2 человека": 70,
           "Больше 2 человек": 100
       },
       "our_time_id": 322
   },
]
```

Бронирование
---

Метод: POST

На указанный вами URL будут приходить следующие поля:

* comment - комментарий от клиента (если есть)
* datetime - дата и время игры в формате "Y-m-d H:i:s"
* email
* name - имя клиента
* phone - телефон клиента
* players_num - количество игроков
* price - цена игры
* signature - описано в начале документа
* source - от нас всегда "extrareality"
* uid: уникальный ID брони на нашем сайте

Также мы можем отправлять дополнительные параметры, которые указаны в слотах вашего расписания, например our_time_id, или прочие по предварительному согласованию.

В случае успешной обработки запроса вам необходимо вернуть ответ в json:

```json
{"success": true}
```

В случае неудачи вернуть:

```json
{"success":false, "message": "error message"}
```

Здесь в поле message текст с причиной ошибки.

Пример:

**Запрос**

```http request
POST https://superquestsite.com/api/quest2/book

name=Иван
    &comment=Комментарий
    &date=2019-05-01
    &email=test@tut.by
    &our_time_id"=>"124"
    &phone=375291234567
    &price=120,
    &signature=5a4fic756e812c09f91c46dd04bc9174,
    &source=extrareality
    &time=20:00
    &uid=854
```

**Ответ**

```json
{"success": true}
```

или

```json
{"success": false, "message": "Ваше имя не Джеймс Бонд" }
```